# Node项目实战

## 零、主要内容

- 项目介绍和搭建
- 注册接口的逻辑
- 登录用户的凭证
- 发表动态和评论
- 动态的标签接口
- 图片上传和存储

## 一、项目介绍和搭建

### 1. coderhub功能接口说明

- 完整的项目接口
  - 面向用户的业务接口
  - 面向企业或者内部的后台管理接口

- 完成的功能如下
  - 用户管理系统
  - 内容管理系统
  - 内容评论管理
  - 内容标签管理
  - 文件管理系统
  - 其他功能

### 2. 项目的搭建

#### 功能一：目录结构的划分

- 按照功能模块划分
- 按照业务模块划分

#### 功能二：应用配置信息写到环境变量

- 编写 .env 文件
- 通过 dotenv 加载配置的变量

#### 功能三：创建和启动服务器

- 基于 koa 创建 app
- 启动服务器

### 功能接口实现

#### 1. 用户注册接口

- 用户注册接口编写流程
  - 注册用户路由 router 编写
  - 处理函数的控制器controller编写
  - 操作数据库的service编写
- 数据库连接操作：mysql2
  - 创建数据库连接
  - 测试数据库连接是否成功
- 注册用户校验
  - 用户名或密码不能为空
  - 用户名没有被注册

#### 2. 错误统一处理

- 封装错误处理函数

```js
const errorHandle = (err, ctx) => {
  let code = 0, message = ''
  switch (err) {
    case NAME_OR_PASSWORD_IS_REQUIRED:
      code = -1001
      message = '用户名或密码不能为空~'
      break;
  }
  ctx.body = { code, message }
}
```

- App 箭头错误事件

```js
app.on('error', errorHandle)
```

#### 3. 用户登陆接口

- 用户登陆接口编写流程
  - 授权router的编写
  - 处理函数的controller编写
- 验证的中间件
  - 账号和密码是否为空
  - 用户名是否存在
  - 校验密码是否一致
- 登陆成功返回凭证
  - cookie+session
  - Token令牌

**为什么需要登陆凭证？**

**认识cookie：**

- Cookie，类型为“小型文本文件”，某些网站为了辨别用户身份而存储在用户本地终端（Client Side）上的数据
  - 浏览器会在特定的情况相爱携带上cookie来发送请求，可以通过cookie来获取一些信息
- Cookie总是保存在客户端中，按照客户端中的存储位置，可以分为内存Cookie和硬盘Cookie
  - 内存Cookie由浏览器维护，保存在内存中，浏览器关闭时Cookie就会消失，存在时间是短暂的
  - 硬盘Cookie保存在硬盘中，有一个过期时间，用户手动清理或者过期时间到，才会被清理
