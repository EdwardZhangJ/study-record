# 邂逅 SVG

## 一、介绍

SVG 全称为（Scalable Vector Graphics），即可缩放矢量图形。（矢量定义：既有大小又有方向的量。在物理学中称作矢 量，如一个带箭头线段：长度表示大小，箭头表示方向；在数学中称作向量。在计算机中，矢量图可无限放大而不变形）

SVG 是一种基于 XML 格式的矢量图，主要用于定义二维图形，支持交互和动画

SVG 规范是万维网联盟(W3C) 自 1998 年以来开发的标准

SVG 图像可在不损失质量的情况下按比例缩放，并支持压缩

基于 XML 的 SVG 可轻松的用文本编辑器或矢量图形编辑器创建和编辑，并可以直接在浏览器显示

### 1.1 优缺点

#### 优点

- 扩展好：矢量图像在浏览器中放大缩小不会失真，可被许多设备和浏览器中使用。而光栅图像（PNG 、JPG）放大缩小会失真
  - 矢量图像是基于矢量的点、线、形状和数学公式来构建的图形，该图形是没有像素的，放大缩小是不会失真的
  - 光栅图像是由像素点构建的图像——微小的彩色方块，大量像素点可以形成高清图像，比如照片。图像像素越多，质量越高
- 灵活：SVG 是 W3C 开发的标准，可结合其它的语言和技术一起使用，包括 CSS、JavaScript、 HTML 和 SMIL 。SVG 图像可以 直接使用 JS 和 CSS 进行操作，使用时非常方便和灵活，因为 SVG 也是可集成到 DOM 中的
- 可以动画
- 轻量级
- 可打印
- 利于 SEO
- 可压缩
- 易于编辑

#### 缺点

- 不适合制作高清图片
- SVG 图像变得复杂时，加载慢
- 不完全扩展平台

### 1.2 应用场景

以下是一些保证 SVG 优于其他图像格式的应用场景

- SVG 非常适合显示矢量徽标（Logo）、图标（ICON）和其他几何设计
- SVG 适合应用在需适配多种尺寸的屏幕上展示，因为 SVG 的扩展性更好
- 当需要创建简单的动画时，SVG 是一种理想的格式
  - SVG 可以与 JS 交互来制作线条动画、过渡和其他复杂的动画
  - SVG 可以与 CSS 动画交互，也可以使用自己内置的 SMIL 动画
- SVG 也非常适合制作各种图表（条形图、折线图、饼图、散点图等等），以及大屏可视化页面开发

### 1.3 SVG 和 Canvas 的区别

在以下几个方面的区别：

- 扩展性
  - SVG 是基于矢量的点、线、形状和数学公式来构建的图形，该图形是没有像素的，放大缩小不会失真
  - Canvas 是由一个个像素点构成的图形，放大会使图形变得颗粒状和像素化（模糊）
  - SVG 可以在任何分辨率下以高质量的打印。Canvas 不适合在任意分辨率下打印
- 渲染能力
  - 当 SVG 很复杂时，它的渲染就会变得很慢，因为在很大程度上去使用 DOM 时，渲染会变得很慢
  - Canvas 提供了高性能的渲染和更快的图形处理能力，例如：适合制作 H5 小游戏
  - 当图像中具有大量元素时，SVG 文件的大小会增长得更快（导致 DOM 变得复杂），而 Canvas 并不会增加太多
- 灵活度
  - SVG 可以通过 JavaScript 和 CSS 进行修改，用 SVG 来创建动画和制作特效非常方便
  - Canvas 只能通过 JavaScript 进行修改，创建动画得一帧帧重绘
- 使用场景
  - Canvas 主要用于游戏开发、绘制图形、复杂照片的合成，以及对图片进行像素级别的操作，如：取色器、复古照片
  - SVG 非常适合显示矢量徽标（Logo）、图标（ICON）和其他几何设计

## 二、初体验 SVG

**如何绘制一个 SVG 矢量图？**
绘制 SVG 矢量图常用有 4 种方式:

- 方式一：在一个单独的 svg 文件中绘制，svg 文件可直接在浏览器预览或嵌入到 HTML 中使用（推荐）
- 方式二：直接在 HTML 文件中使用 svg 元素来绘制（推荐）
- 方式三：直接使用 JavaScript 代码来生成 svg 矢量图。
- 方式四：使用 AI（Adobe Adobe Illustrator）矢量绘图工具来绘制矢量图，并导出为 svg 文件（推荐）

**SVG 初体验步骤：**

- 第一步：新建一个 svg 文件，在文件第一行编写 XML 文件声明
- 第二步：编写一个`<svg>`元素，并给该元素添加如下属性：
  - width / height ：指定 svg 画布（视口）的宽和高，默认值分别为 300 和 150，默认使用 px 单位
  - xmlns：给 svg 元素帮定一个命名空间`http://www.w3.org/2000/svg` 意味着这个 `<svg>` 标签和它的子元素都属于该命名空间下
- 第三步：在< svg >元素中添加图形（比如：< rect >）元素
- 第四步：在浏览器直接预览或嵌入到 HTML 中预览（嵌入 HTML 有 6 种方案）

### 2.1 XML 和 DTD 声明

由于 SVG 是一个 XML 文件格式。在编写 XML 文档时，通常是推荐编写 XML 声明。因为在 XML 1.0 中，XML 声明是可选的，推荐写但不是强制性。 然而，在 XML 1.1 中，声明是强制性的，如果没有声明，则自动暗示该文档是 XML 1.0 文档。所以这里建议大家在编写 SVG 文件时也编写一个
XML 声明

SVG 的 XML 声明格式:

```xml
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
```

- version 指定版本（必填）
- encoding 指定XML文档的编码（可选，默认是UTF-8）
- standalone：指定当前 XML 文档是否依赖于外部标记声明（可选，使用该属性时，需和DTD声明一起用才有意义）
  - 默认为no：代表依赖外部标记声明
  - yes：代表依赖内部默认的标记声明

SVG的文档类型声明（DTD），让解析器验证XML文件是否符合该规范，与HTML5文件的DTD声明类似

### 2.2 SVG 文档结构

### 2.3 JS 创建 SVG

使用JS脚本来创建SVG时，创建的元素都是需要添加命名空间的

- 比如：创建<svg>或者<rect>元素都需要添加命名空间（`http://www.w3.org/2000/svg`）
- 对于元素上的属性如果不带前缀的，命名空间赋值为null
- 
创建 SVG 常用的 DOM2 API

- createElementNS（ns，elName）：创建SVG元素
- setAttributeNS（ns，attrName，value）：给SVG元素添加属性
- getAttributeNS（ns，attrName）：获取SVG元素上的属性
- hasAttributeNS（ns, attrName）： 判断SVG元素上是否存在某个属性
- removeAttributeNS（ns，attName）：删除SVG元素上的某个属性

### 2.4 HTML 引入 SVG

## 三、SVG 基础内容

### 3.1 网格和坐标系

SVG 使用的坐标系统（网格系统）和 Canvas的差不多。坐标系是 以左上角为 (0,0) 坐标原点，坐标以像素为单位，x 轴正方向 是向右，y 轴正方向是向下。

- <svg>元素默认宽为 300px, 高为 150px
- 基本上在 SVG 文档中的 1 个像素对应输出设备（比如显示屏）上的 1 个像素（除非缩放）
- <font color="red">`<svg>`的 transform 属性可以用来移动、旋转、缩放SVG中的某个元素，如`<svg>`中某个元素用了变形，该元素内部会建立 一个新的坐标系统，该元素默认后续所有变化都是基于新创建的坐标系统 </font>

#### SVG 坐标系单位

SVG坐标系统，在没有明确指定单位时，默认以像素为单位
也可以手动指明坐标系的单位:
em、ex、px、pt、pc、cm、mm、in

### 3.2 视口和视图框

#### 3.2.1 视口 viewport

- 视口是 SVG 可见的区域（也可以说是SVG画布大小）。可以将视口视为可看到特定场景的窗口
- 可以使用<svg>元素的width和height属性指定视口的大小
- 一旦设置了最外层 SVG 元素的宽度和高度，浏览器就会建立初始视口坐标系和初始用户坐标系

视口坐标系

- 视口坐标系是在视口上建立的坐标系，原点在视口左上角的点(0, 0)，x轴正向向右，y轴正向下
- 初始视口坐标系中的一个单位等于视口中的一个像素，该坐标系类似于 HTML 元素的坐标系

用户坐标系（ 也称为当前坐标系或正在使用的用户空间，后面绘图都是参照该坐标系）

- 用户坐标系是建立在 SVG 视口上的坐标系。该坐标系最初与视口坐标系相同——它的原点位于视口的左上角
- 使用viewBox属性，可以修改初始用户坐标系，使其不再与视口坐标系相同

**为何要两个坐标系？**
因为SVG是矢量图，支持任意缩放。在用户坐标系统绘制的图形，最终会参照视口坐标系来进行等比例缩放

#### 3.2.2 视图框 viewBox

### 3.3 绘制形状和路径

### 3.4 绘制文字和图片

### 3.5 SVG 分组和复用

### 3.6 填充和边框

### 3.7 渐变和滤镜

### 3.8 SVG 形变

### 3.9 路径描边动画
